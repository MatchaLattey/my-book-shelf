<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --frame-color: #b68d6d; 
      --shelf-bg: #fffaf2;   
      --book-read: #d8b08c;
      --book-reading: #a67c52;
      --book-tbr: #eed9c1;
    }

    body { background-color: transparent; display: flex; justify-content: center; padding: 10px; font-family: 'Segoe UI', sans-serif; }
    
    /* SETTINGS MENU - FIXED & VISIBLE */
    #settings-container {
      position: fixed; top: 10px; right: 10px; z-index: 100;
      display: flex; flex-direction: column; align-items: flex-end;
    }
    #gear-icon { font-size: 24px; cursor: pointer; background: white; border-radius: 50%; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); opacity: 0.8; transition: opacity 0.3s; }
    #settings-container:hover #gear-icon { opacity: 1; }
    
    #settings-menu {
      display: none; background: white; padding: 15px; border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4); width: 240px; margin-top: 8px; 
      font-size: 12px; max-height: 80vh; overflow-y: auto;
    }
    #settings-container:hover #settings-menu { display: block; }

    .menu-header { font-weight: bold; font-size: 14px; margin-bottom: 15px; border-bottom: 2px solid #6b4f3a; padding-bottom: 5px; color: #6b4f3a; }
    .setting-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
    .setting-item label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
    
    select, input[type="text"] { width: 90%; padding: 6px; border-radius: 4px; border: 1px solid #ccc; font-size: 11px; margin-bottom: 8px; }
    input[type="range"] { width: 90%; margin-top: 5px; cursor: pointer; }

    /* THE SAVE BUTTON */
    .save-btn {
      width: 100%; padding: 12px; background: #2ecc71; color: white; border: none; 
      border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: background 0.2s;
    }
    .save-btn:hover { background: #27ae60; }

    /* BOOKCASE */
    .bookcase {
      width: 100%; max-width: 450px; background: var(--frame-color);
      display: grid; grid-template-rows: repeat(4, 1fr); gap: 15px;
      padding: 20px; border: 10px solid #a37a5a; border-radius: 4px;
    }
    .shelf {
      height: 125px; background-color: var(--shelf-bg); border-bottom: 10px solid #a37a5a;
      display: flex; align-items: flex-end; padding: 0 15px; gap: 6px; position: relative;
    }
    .deco { position: absolute; bottom: 5px; z-index: 5; pointer-events: none; }
    
    .book {
      width: 32px; writing-mode: vertical-rl; text-align: center; font-size: 11px; font-weight: bold;
      color: #5d4037; border: 1px solid rgba(0,0,0,0.1); border-radius: 3px 3px 0 0;
      transition: transform 0.2s; cursor: pointer; display: flex; justify-content: center; align-items: center;
    }
    .book:hover { transform: translateY(-10px); z-index: 10; }
    .status-Read { background: var(--book-read); height: 85px; }
    .status-Reading { background: var(--book-reading); height: 110px; color: #fff; }
    .status-TBR { background: var(--book-tbr); height: 75px; }
  </style>
</head>
<body>

<div id="settings-container">
  <div id="gear-icon">‚öôÔ∏è</div>
  <div id="settings-menu">
    <div class="menu-header">Shelf Settings</div>
    
    <div class="setting-item">
      <label>Wood Color</label>
      <input type="color" id="colorPicker" onchange="updateColor(this.value)">
    </div>
    
    <div class="setting-item">
      <label>‚è∞ Item 1 (Clock)</label>
      <input type="text" id="clockUrlInput" placeholder="Paste Image URL" onchange="updateDecoUrl('clock', this.value)">
      <select id="clockShelfSelect" onchange="moveDeco('clock', this.value)">
        <option value="1">Shelf 1</option>
        <option value="2">Shelf 2</option>
        <option value="3">Shelf 3</option>
        <option value="4">Shelf 4</option>
        <option value="none">Hidden</option>
      </select>
      <label style="font-weight:normal; font-size:10px;">Size Adjust</label>
      <input type="range" id="clockSizeRange" min="20" max="150" oninput="resizeDeco('clock', this.value)">
    </div>

    <div class="setting-item">
      <label>ü™¥ Item 2 (Plant)</label>
      <input type="text" id="plantUrlInput" placeholder="Paste Image URL" onchange="updateDecoUrl('plant', this.value)">
      <select id="plantShelfSelect" onchange="moveDeco('plant', this.value)">
        <option value="1">Shelf 1</option>
        <option value="2">Shelf 2</option>
        <option value="3">Shelf 3</option>
        <option value="4">Shelf 4</option>
        <option value="none">Hidden</option>
      </select>
      <label style="font-weight:normal; font-size:10px;">Size Adjust</label>
      <input type="range" id="plantSizeRange" min="20" max="150" oninput="resizeDeco('plant', this.value)">
    </div>

    <button class="save-btn" onclick="saveSettings()">üíæ SAVE MY DESIGN</button>
  </div>
</div>

<div class="bookcase">
  <div class="shelf" id="shelf-1"></div>
  <div class="shelf" id="shelf-2"></div>
  <div class="shelf" id="shelf-3"></div>
  <div class="shelf" id="shelf-4"></div>
</div>

<script>
  let config = {
    workerUrl: 'https://notion-bridge.violily67.workers.dev/', 
    color: '#b68d6d',
    clockImg: 'https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3B4eW13bmZ5ZnR4eW13bmZ5ZnR4eW13bmZ5ZnR4eW13bmZ5JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1z/3o7TKVUn7iM8FMEU24/giphy.gif',
    plantImg: 'https://i.pinimg.com/originals/1f/4e/ba/1f4eba6f27790b213ba570f8ba63273c.gif',
    clockShelf: '2',
    plantShelf: '3',
    clockSize: '45',
    plantSize: '60'
  };

  function loadSettings() {
    const saved = localStorage.getItem('bookshelf_settings');
    if (saved) {
      config = JSON.parse(saved);
      document.getElementById('colorPicker').value = config.color;
      document.getElementById('clockShelfSelect').value = config.clockShelf;
      document.getElementById('plantShelfSelect').value = config.plantShelf;
      document.getElementById('clockSizeRange').value = config.clockSize;
      document.getElementById('plantSizeRange').value = config.plantSize;
      updateColor(config.color);
    }
  }

  function saveSettings() {
    localStorage.setItem('bookshelf_settings', JSON.stringify(config));
    alert("Saved! Your design is now locked in.");
  }

  function updateColor(val) { 
    config.color = val;
    document.documentElement.style.setProperty('--frame-color', val); 
  }

  function resizeDeco(type, val) {
    config[type + 'Size'] = val;
    const img = document.getElementById(type + '-id');
    if (img) img.style.width = val + 'px';
  }

  function updateDecoUrl(type, url) {
    if (!url) return;
    if (type === 'clock') config.clockImg = url;
    if (type === 'plant') config.plantImg = url;
    moveDeco(type, config[type + 'Shelf']);
  }

  function moveDeco(type, shelfId) {
    config[type + 'Shelf'] = shelfId;
    const old = document.getElementById(type + '-id');
    if (old) old.remove();
    if (shelfId === 'none') return;

    const shelf = document.getElementById(`shelf-${shelfId}`);
    const img = document.createElement('img');
    img.id = type + '-id';
    img.src = type === 'clock' ? config.clockImg : config.plantImg;
    img.className = 'deco';
    img.style.width = config[type + 'Size'] + 'px';
    
    if (type === 'clock') { img.style.right = '10px'; } 
    else { img.style.left = '50%'; img.style.transform = 'translateX(-50%)'; }
    
    shelf.appendChild(img);
  }

  async function fetchBooks() {
    loadSettings();
    try {
      const response = await fetch(config.workerUrl);
      const books = await response.json();
      moveDeco('clock', config.clockShelf);
      moveDeco('plant', config.plantShelf);

      books.forEach(book => {
        const shelf = document.getElementById(`shelf-${book.shelf}`);
        if (shelf) {
          const el = document.createElement('div');
          el.className = `book status-${book.status}`;
          el.title = book.title;
          el.innerText = book.title.substring(0, 10);
          shelf.appendChild(el);
        }
      });
    } catch (e) { console.error("Error:", e); }
  }

  fetchBooks();
</script>

</body>
</html>
