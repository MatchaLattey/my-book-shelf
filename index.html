<!DOCTYPE html>
<html>
<head>
  <style>
    :root {
      --frame-color: #b68d6d; 
      --shelf-bg: #fffaf2;   
    }

    body { background-color: transparent; display: flex; justify-content: center; padding: 10px; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
    
    /* SETTINGS MENU */
    #settings-container {
      position: fixed; top: 10px; right: 10px; z-index: 1000;
      display: flex; flex-direction: column; align-items: flex-end;
    }
    #gear-icon { font-size: 24px; cursor: pointer; background: white; border-radius: 50%; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
    #settings-menu {
      display: none; background: white; padding: 15px; border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4); width: 240px; margin-top: 8px; 
      font-size: 12px; max-height: 85vh; overflow-y: auto;
    }
    #settings-container:hover #settings-menu { display: block; }
    .menu-header { font-weight: bold; font-size: 14px; margin-bottom: 10px; border-bottom: 2px solid #6b4f3a; color: #6b4f3a; display: flex; justify-content: space-between; }
    .sync-btn { padding: 4px 8px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; }

    /* BOOKCASE */
    .bookcase {
      width: 90vw; max-width: 500px; background: var(--frame-color);
      display: grid; grid-template-rows: repeat(4, 1fr); gap: 15px;
      padding: 20px; border: 10px solid #a37a5a; border-radius: 4px;
    }
    
    .shelf {
      height: 120px; background-color: var(--shelf-bg); border-bottom: 8px solid #a37a5a;
      display: flex; align-items: flex-end; padding: 0 10px; gap: 4px; position: relative;
      /* SCROLLING ENABLED */
      overflow-x: auto; 
      overflow-y: hidden; 
      white-space: nowrap;
      cursor: grab; /* Shows user they can drag */
    }
    
    .shelf:active { cursor: grabbing; }

    /* VISIBLE SCROLLBAR */
    .shelf::-webkit-scrollbar { height: 8px; }
    .shelf::-webkit-scrollbar-track { background: #f1f1f1; }
    .shelf::-webkit-scrollbar-thumb { background: #d2b48c; border-radius: 10px; }

    /* BOOKS */
    .book {
      flex: 0 0 auto; 
      position: relative;
      z-index: 10; 
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 2px 2px 0 0;
      transition: transform 0.2s;
      display: flex; justify-content: center; align-items: center;
      writing-mode: vertical-rl;
      font-size: 10px; font-weight: 800; color: #000;
      text-transform: uppercase;
      box-shadow: inset -2px 0 5px rgba(0,0,0,0.05);
      user-select: none; /* Prevents text highlight while dragging */
    }
    .book:hover { transform: translateY(-10px) scale(1.1); z-index: 500 !important; }

    .book-thin { width: 22px; height: 80px; }
    .book-standard { width: 34px; height: 95px; }
    .book-fat { width: 48px; height: 110px; }

    .tilt-left { transform: rotate(-6deg); transform-origin: bottom; margin-right: 4px; }
    .tilt-right { transform: rotate(6deg); transform-origin: bottom; margin-left: 4px; }

    .deco { position: absolute; bottom: 5px; z-index: 200; pointer-events: none; }

    .status-badge {
      position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
      width: 14px; height: 14px; border-radius: 50%; background: white;
      display: flex; align-items: center; justify-content: center;
      font-size: 9px; writing-mode: horizontal-tb; border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<div id="settings-container">
  <div id="gear-icon">‚öôÔ∏è</div>
  <div id="settings-menu">
    <div class="menu-header">Shelf Settings <button class="sync-btn" onclick="fetchBooks()">üîÑ SYNC</button></div>
    </div>
</div>

<div class="bookcase">
  <div class="shelf" id="shelf-1"></div>
  <div class="shelf" id="shelf-2"></div>
  <div class="shelf" id="shelf-3"></div>
  <div class="shelf" id="shelf-4"></div>
</div>

<script>
  // ... existing config ...
  const ghibliPalette = ['#e8d1b5', '#d9adad', '#b5c9c3', '#c7d6a5', '#dfc5e0', '#f4e3ad', '#a7c1d1', '#d2b48c'];

  // CLICK AND DRAG SCROLL LOGIC
  document.querySelectorAll('.shelf').forEach(shelf => {
    let isDown = false;
    let startX;
    let scrollLeft;

    shelf.addEventListener('mousedown', (e) => {
      isDown = true;
      startX = e.pageX - shelf.offsetLeft;
      scrollLeft = shelf.scrollLeft;
    });
    shelf.addEventListener('mouseleave', () => isDown = false);
    shelf.addEventListener('mouseup', () => isDown = false);
    shelf.addEventListener('mousemove', (e) => {
      if (!isDown) return;
      e.preventDefault();
      const x = e.pageX - shelf.offsetLeft;
      const walk = (x - startX) * 2; // Scroll speed
      shelf.scrollLeft = scrollLeft - walk;
    });
  });

  async function fetchBooks() {
    try {
      const response = await fetch(`https://notion-bridge.violily67.workers.dev/?t=${Date.now()}`);
      const books = await response.json();
      document.querySelectorAll('.book').forEach(b => b.remove());
      
      books.forEach(book => {
        const shelf = document.getElementById(`shelf-${book.shelf}`);
        if (shelf) {
          const el = document.createElement('div');
          const sizeClass = ['book-thin', 'book-standard', 'book-fat'][Math.floor(Math.random() * 3)];
          const tiltClass = ['', 'tilt-left', 'tilt-right'][Math.floor(Math.random() * 3)];
          el.className = `book ${sizeClass} ${tiltClass} status-${book.status}`;
          el.style.backgroundColor = ghibliPalette[Math.floor(Math.random() * ghibliPalette.length)];
          el.innerText = book.title.substring(0, 10);
          const badge = document.createElement('div');
          badge.className = 'status-badge';
          el.appendChild(badge);
          shelf.appendChild(el);
        }
      });
    } catch (e) { console.error(e); }
  }
  fetchBooks();
</script>
</body>
</html>
